SELECT DISTINCT
 

       EMP.EMPLOYEE_AHSN 
      ,EMP.EMPLOYEE_ID
      ,EMP.LAST_NAME
      ,EMP.PREFERRED_NAME 

	  ,WA.LOCATION
	  ,loc.DESCRIPTION

	  ,EMP.DEPARTMENT_NAME
	  ,EMP.JOB_CODE
	  ,EMP.JOB_TITLE
	  ,EMP.POSITION_CODE
      ,EMP.POSITION_DESCRIPTION
  
	  ,HRCOMM.SFNAME AS SubFunction	
	  ,HRCOMM.FNNAME AS [Function] 
	  ,HRCOMM.ENTNAME AS Entity
  
	  ,WA.SALARYSTRUCTURE
	  ,SS.DESCRIPTION
	  ,SS.[SALARYSTRUCTUREVERSION]


	  ,EMP.STATUS
	  ,EMP.RELATIONSHIPTOORGANIZATION

  
FROM [HRIS_Views].[dbo].[vwEmployeeCurrentViewAllEmployee] AS EMP (NOLOCK)
  LEFT JOIN LTMPROD.hcm.WORKASSIGNMENT as WA (NOLOCK)
  ON EMP.EMPLOYEE_ID = WA.EMPLOYEE
  AND WA.ACTIVE = 1
  INNER JOIN [HRIS_Views].hcm.vwHRLOCATION loc (NOLOCK)
  ON WA.LOCATION = loc.HRLOCATION
  LEFT JOIN LTMPROD.hcm.SUPERVISOR as SUPV(NOLOCK)
  ON WA.DIRECTSUPERVISOR = SUPV.SUPERVISOR
  LEFT JOIN  LTMPROD.hcm.EMPLOYEE as EMPTBL (NOLOCK)
  ON SUPV.PRIMARYRESOURCEFORHRMS = EMPTBL.EMPLOYEE
  LEFT JOIN LTMPROD.hcm.POSITION as POS (NOLOCK)
  ON WA.POSITION = POS.POSITION


  INNER JOIN ( SELECT SS.SALARYSTRUCTURE, SS.DESCRIPTION, SS.[SALARYSTRUCTUREVERSION], ROW_NUMBER() over(partition by SALARYSTRUCTURE ORDER BY [SALARYSTRUCTUREVERSION] DESC) AS ROWNUM FROM LTMPROD.hcm.SALARYSTRUCTURE SS (NOLOCK)
  ) AS SS
  ON WA.SALARYSTRUCTURE = SS.SALARYSTRUCTURE
  AND SS.ROWNUM = 1

  INNER JOIN LTMPROD.hcm.EMPLOYEE AS EWA (NOLOCK)
  ON EWA.EMPLOYEE = EMP.EMPLOYEE_ID AND EWA.PRIMARYWORKASSIGNMENT = WA.WORKASSIGNMENT
  INNER JOIN LTMPROD.hcm.USERFIELD_STORAGE as UFS (NOLOCK)
  ON POS.UNIQUEID = UFS.UFSUNIQUEID AND UFSFIELDNAME = 'NortonCheckRequestLevel'
  INNER JOIN (
  SELECT CC.HRORGANIZATION, CC.HRORGANIZATIONUNIT, CC.PARENTUNIT, CC.DESCRIPTION AS 'CCNAME', CC.ACTIVE, CC.UNITTYPE, SF.DESCRIPTION AS 'SFNAME',  FN.DESCRIPTION AS 'FNNAME', EN.DESCRIPTION AS 'ENTNAME'
  FROM   LTMPROD.hcm.HRORGANIZATIONUNIT CC
  JOIN LTMPROD.hcm.HRORGANIZATIONUNIT SF
  ON CC.PARENTUNIT=SF.HRORGANIZATIONUNIT
  JOIN LTMPROD.hcm.HRORGANIZATIONUNIT FN
  ON SF.PARENTUNIT=FN.HRORGANIZATIONUNIT 
  JOIN LTMPROD.hcm.HRORGANIZATIONUNIT SC
  ON FN.PARENTUNIT=SC.HRORGANIZATIONUNIT 
  JOIN LTMPROD.hcm.HRORGANIZATIONUNIT EN
  ON SC.PARENTUNIT=EN.HRORGANIZATIONUNIT
  WHERE  CC.UNITTYPE='COSTCENTER' AND CC.ACTIVE='1') 
  AS HRCOMM
  ON HRCOMM.HRORGANIZATIONUNIT = WA.HRORGANIZATIONUNIT
  WHERE (EMP.STATUS = 'Active' OR EMP.STATUS = 'Leave' OR EMP.STATUS = 'Admin Leave' OR EMP.STATUS = 'Job Placement')

  GO
